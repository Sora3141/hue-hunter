<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Hue Hunter | Cloud Sync</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="ad-top-container">
        <script src="https://adm.shinobi.jp/s/3be4a74111b0e4660a4445b3864b1a35"></script>
        </div>

    <div class="header">
        <div class="score-label">SCORE</div>
        <h1 id="score-display">0</h1>
    </div>

    <div id="game-board"></div>
    <button id="back-to-result" onclick="showResult(false)">çµæœã«æˆ»ã‚‹</button>

    <div id="start-screen">
        <div style="height: 40px;"></div>
        <h1 class="game-title">HUE<br>HUNTER</h1>
        <div id="auth-ui">
            <div id="login-options">
                <button id="btn-google-login" class="btn-start" onclick="login()">Googleã§ãƒ­ã‚°ã‚¤ãƒ³</button>
                <button id="btn-guest" class="btn-look" style="margin-top:12px; opacity:0.8;" onclick="continueAsGuest()">ãƒ­ã‚°ã‚¤ãƒ³ã›ãšã«éŠã¶</button>
                <p style="font-size: 0.7rem; color: #888; margin-top: 15px;">â€»ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ãƒ‡ãƒã‚¤ã‚¹é–“ã§æœ€é«˜è¨˜éŒ²ã‚’åŒæœŸã§ãã¾ã™</p>
            </div>

            <div id="setup-ui" style="display:none;">
                <p id="welcome-msg"></p>
                <input type="text" id="display-name" placeholder="è¡¨ç¤ºåã‚’å…¥åŠ›" maxlength="8">
                <br>
                <button class="btn-start" onclick="startGame()">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
            </div>

            <button class="btn-look" style="margin-top: 20px;" onclick="openFullRanking()">ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
        </div>
    </div>

    <div id="result-overlay">
        <div id="new-record-label" style="display:none;">â˜… NEW RECORD â˜…</div>
        <div id="res-rank" class="rank-name">---</div>

        <div id="ad-result-container">
            <script src="https://adm.shinobi.jp/s/fbe3608133af14816ff830129b4da30b"></script>
            </div>

        <div id="res-msg" class="msg-text">---</div>

        <div id="ranking-container">
            <div id="ranking-header">
                <span>TOP 5</span>
                <span id="login-status">Checking...</span>
            </div>
            <div id="ranking-list">Loading rankings...</div>
            
            <div id="ranking-footer" style="text-align: center; margin-top: 10px; display: none;">
                <span id="btn-show-all" onclick="openFullRanking()" class="link-button">ã‚‚ã£ã¨è¦‹ã‚‹ â–¼</span>
            </div>
        </div>

        <div id="guest-login-notice" style="display:none;">
            <button onclick="login()" class="btn-sync-notice">Googleãƒ­ã‚°ã‚¤ãƒ³ã—ã¦åŒæœŸã‚’æœ‰åŠ¹åŒ–</button>
        </div>

        <div class="result-stats">
            <div class="stat-item">
                <span class="stat-label">SCORE</span>
                <span id="res-score" class="stat-value">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">BEST</span>
                <span id="res-best" class="stat-value">0</span>
            </div>
        </div>

        <div class="btn-group">
            <button class="btn-restart" onclick="resetGame()">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button>
            <button class="btn-look" onclick="peekBoard()">ç›¤é¢ã‚’ç¢ºèªã™ã‚‹</button>
        </div>

        <div style="height: 60px; flex-shrink: 0;"></div>
    </div>

    <div id="full-ranking-modal">
        <div class="modal-header">
            <h2>RANKING</h2>
            <button class="btn-close" onclick="closeFullRanking()">Ã—</button>
        </div>
        <div id="full-ranking-list">Loading...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDoc, query, orderBy, limit, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB933UwRnTI71Vt4cNJDJxTApYtvCDBhOE",
            authDomain: "huehunterworld.firebaseapp.com",
            projectId: "huehunterworld",
            storageBucket: "huehunterworld.firebasestorage.app",
            messagingSenderId: "627186904630",
            appId: "1:627186904630:web:6a41bc37ef49fcca82f297"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.fb = { auth, db, GoogleAuthProvider, signInWithPopup, collection, doc, setDoc, getDoc, query, orderBy, limit, getDocs, serverTimestamp };

        onAuthStateChanged(auth, (user) => {
            const status = document.getElementById('login-status');
            if (user) {
                status.innerText = "Logged In";
                status.style.color = "#4CAF50";
            } else {
                status.innerText = "Guest Mode";
                status.style.color = "#888";
            }
        });
    </script>
    <div class="version-info">ver 1.0.0</div>
    <script src="script.js"></script>
</body>
</html>